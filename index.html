
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>평택마이스터고등학교 앱</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, background-color 0.3s ease-in-out;
        }

        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 25px rgba(0,0,0,0.2);
        }

        /* Timetable card specific styling */
        .timetable-card {
            background-color: #f5f3ff; /* Purple-50 */
        }

        .timetable-card:hover {
            background-color: #e5e7eb; /* Gray-200 */
        }

        /* Timetable image modal */
        #modal-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center">

    <!-- App Container -->
    <div id="app" class="bg-white shadow-2xl rounded-3xl w-[375px] h-[667px] max-w-full max-h-full flex flex-col overflow-hidden border-8 border-gray-800">
        
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 text-center shadow-lg">
            <h1 class="text-2xl font-bold">평택마이스터고등학교</h1>
        </header>

        <!-- Main Content Area (dynamic) -->
        <main class="flex-1 overflow-y-auto p-4 bg-gray-50">

            <!-- Home Page -->
            <div id="page-home" class="page">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">환영합니다!</h2>
                <div class="grid grid-cols-2 gap-6">
                    <div data-page="gaeyo" class="card bg-gradient-to-br from-indigo-500 to-purple-600 p-6 rounded-2xl shadow-lg text-center text-white cursor-pointer">
                        <!-- Info Icon SVG -->
                        <svg class="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>
                        <h3 class="font-semibold text-xl">학교 개요</h3>
                    </div>
                    <div data-page="time" class="card bg-gradient-to-br from-green-500 to-teal-600 p-6 rounded-2xl shadow-lg text-center text-white cursor-pointer">
                        <!-- Calendar Icon SVG -->
                        <svg class="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/></svg>
                        <h3 class="font-semibold text-xl">시간표</h3>
                    </div>
                    <div data-page="bob" class="card bg-gradient-to-br from-yellow-500 to-orange-600 p-6 rounded-2xl shadow-lg text-center text-white cursor-pointer">
                        <!-- Lunch Icon SVG -->
                        <svg class="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24"><path d="M21 5H3c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zM8 12c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13 5H3V7h18v10z"/></svg>
                        <h3 class="font-semibold text-xl">급식</h3>
                    </div>
                    <div data-page="cm" class="card bg-gradient-to-br from-rose-500 to-red-600 p-6 rounded-2xl shadow-lg text-center text-white cursor-pointer">
                        <!-- Shield Icon SVG -->
                        <svg class="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3z"/></svg>
                        <h3 class="font-semibold text-xl">전공 소개</h3>
                    </div>
                      <div data-page="bob" class="card bg-gradient-to-br from-yellow-500 to-orange-600 p-6 rounded-2xl shadow-lg text-center text-white cursor-pointer">
                        <!-- Lunch Icon SVG -->
                        <svg class="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24"><path d="M21 5H3c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zM8 12c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13 5H3V7h18v10z"/></svg>
                        <h3 class="font-semibold text-xl">급식</h3>
                    </div>
                </div>
            </div>

            <!-- School Overview Page -->
            <div id="page-gaeyo" class="page hidden">
                <button data-page="home" class="back-btn mb-4 px-4 py-2 bg-gray-200 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">← 뒤로가기</button>
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">학교 개요</h2>
                <div class="bg-gray-100 p-6 rounded-2xl shadow-lg">
                    <p class="text-gray-600 leading-relaxed mb-4">
                        평택마이스터고등학교는 미래 산업을 이끌어갈 창의적인 기술 인재를 양성하는 데 주력하고 있습니다. 최신 시설과 우수한 교육 과정을 통해 학생들이 전문성과 인성을 모두 갖춘 글로벌 인재로 성장하도록 돕고 있습니다.
                    </p>
                    <p class="text-blue-600 font-semibold text-center mt-4">"꿈을 향해 성장하는 글로벌 인재 육성!"</p>
                </div>
            </div>
            
            <!-- Timetable Page -->
            <div id="page-time" class="page hidden">
                <button data-page="home" class="back-btn mb-4 px-4 py-2 bg-gray-200 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">← 뒤로가기</button>
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center" id="timetable-title">시간표</h2>

                <!-- Grade Selection -->
                <div id="grade-selection" class="flex flex-col space-y-4 mb-4">
                    <button data-grade="1" class="grade-btn w-full bg-blue-500 text-white px-6 py-3 rounded-2xl font-bold hover:bg-blue-600 transition-colors shadow-lg">1학년</button>
                    <button data-grade="2" class="grade-btn w-full bg-blue-500 text-white px-6 py-3 rounded-2xl font-bold hover:bg-blue-600 transition-colors shadow-lg">2학년</button>
                    <button data-grade="3" class="grade-btn w-full bg-blue-500 text-white px-6 py-3 rounded-2xl font-bold hover:bg-blue-600 transition-colors shadow-lg">3학년</button>
                </div>

                <!-- Class Selection Grid (Initially hidden) -->
                <div id="class-selection-container" class="grid grid-cols-2 gap-4 max-w-lg mx-auto hidden">
                </div>
            </div>

            <!-- Lunch Menu Page -->
            <div id="page-bob" class="page hidden">
                <button data-page="home" class="back-btn mb-4 px-4 py-2 bg-gray-200 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">← 뒤로가기</button>
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">오늘의 급식</h2>
                <div class="flex items-center justify-between mb-4">
                    <button id="prev-day" class="bg-gray-200 p-2 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">&#9664;</button>
                    <span id="current-date" class="font-bold text-lg text-gray-800"></span>
                    <button id="next-day" class="bg-gray-200 p-2 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">&#9654;</button>
                </div>
                <div id="lunch-menu-container" class="bg-white p-6 rounded-2xl shadow-lg min-h-[150px] flex flex-col justify-center items-center">
                    <p id="loading-message" class="text-center text-gray-500">급식 정보를 불러오는 중...</p>
                    <ul id="lunch-menu-list" class="space-y-2 text-gray-700 hidden w-full"></ul>
                </div>
            </div>

            <!-- Major Introduction Page -->
            <div id="page-cm" class="page hidden">
                <button data-page="home" class="back-btn mb-4 px-4 py-2 bg-gray-200 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">← 뒤로가기</button>
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">전공 소개</h2>
                <div class="grid grid-cols-2 gap-4">
                    <button data-major="brother" class="card bg-yellow-100 p-4 rounded-2xl shadow-lg text-center text-yellow-800 hover:bg-yellow-200 transition-colors">산업설비과</button>
                    <button data-major="machine" class="card bg-green-100 p-4 rounded-2xl shadow-lg text-center text-green-800 hover:bg-green-200 transition-colors">로봇제어시스템과</button>
                    <button data-major="auto" class="card bg-red-100 p-4 rounded-2xl shadow-lg text-center text-red-800 hover:bg-red-200 transition-colors">자동차IT과</button>
                    <button data-major="elec" class="card bg-purple-100 p-4 rounded-2xl shadow-lg text-center text-purple-800 hover:bg-purple-200 transition-colors">스마트전자제어과</button>
                </div>
                <div id="major-content-container" class="mt-6 p-6 bg-white rounded-2xl shadow-lg hidden">
                    <h3 id="major-title" class="text-xl font-bold text-gray-800 mb-2"></h3>
                    <p id="major-description" class="text-gray-600 leading-relaxed"></p>
                </div>
            </div>

            <!-- Image Modal -->
            <div id="image-modal" class="hidden fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center p-4">
                <!-- 모달 콘텐츠: 이미지와 버튼을 포함하며 화면 크기에 맞춰 크기 조절 -->
                <div class="relative bg-white rounded-lg shadow-xl p-4 w-[90vw] max-w-[90vw] h-auto max-h-[90vh] flex flex-col items-center">
                    <!-- 닫기(X) 버튼 -->
                    <button id="close-modal-x" class="absolute top-2 right-2 text-gray-500 text-3xl font-bold p-1 leading-none">&times;</button>
                    <!-- 이미지 컨테이너: 넘치는 부분을 스크롤로 처리 -->
                    <div class="overflow-y-auto w-full flex-1 flex items-center justify-center">
                        <img id="modal-image" src="" alt="확대 이미지" class="max-w-full max-h-full object-contain">
                    </div>
                    <!-- 뒤로가기 버튼 -->
                    <button id="close-modal-btn" class="mt-4 w-full px-6 py-2 bg-blue-600 text-white rounded-xl shadow-lg hover:bg-blue-700 transition-colors">뒤로가기</button>
                </div>
            </div>
        </main>
        
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // API 정보
            const serviceKey = '3c12807e4d8d42a0ad5b9f266bc209fa';
            const baseUrl = 'https://open.neis.go.kr/hub/mealServiceDietInfo';
            const atptOfcdcScCode = 'J10'; // 경기도교육청 코드
            const sdSchulCode = '7531408'; // 평택마이스터고등학교 코드
            
            // 전공 소개 데이터
            const majorData = {
                brother: {
                    title: "산업설비과",
                    description: "산업설비과는 기계 및 설비 분야의 기술 전문가를 양성합니다. 다양한 공장 자동화 시스템, 배관 및 용접 기술 등을 배웁니다."
                },
                machine: {
                    title: "로봇제어시스템과",
                    description: "로봇제어시스템과는 산업용 로봇의 설계, 제작, 제어 및 운영 기술을 습득합니다. 4차 산업혁명 시대의 핵심 기술을 다룹니다."
                },
                auto: {
                    title: "자동차IT과",
                    description: "자동차IT과는 미래 자동차 산업을 선도할 기술 인재를 양성합니다. 친환경 자동차, 자율주행 기술 등 IT 융합 기술을 배웁니다."
                },
                elec: {
                    title: "스마트전자제어과",
                    description: "스마트전자제어과는 전자기기 및 시스템을 설계하고 제어하는 기술을 익힙니다. 회로 설계, 프로그래밍, IoT 기술 등을 포함합니다."
                }
            };

            // 학년별 시간표 데이터 (이미지 링크를 업데이트했습니다.)
            const timetableData = {
                '1': [
                    { class: '1반', img: '/images/time1_1.png' },
                    { class: '2반', img: '/images/time1_2.png' },
                    { class: '3반', img: '/images/time1_3.png' },
                    { class: '4반', img: '/images/time1_4.png' },
                    { class: '5반', img: '/images/time1_5.png' },
                    { class: '6반', img: '/images/time1_6.png' },
                    { class: '7반', img: '/images/time1_7.png' },
                    { class: '8반', img: '/images/time1_8.png' },
                ],
                '2': [
                    { class: '1반', img: '/images/time2_1.png' },
                    { class: '2반', img: '/images/time2_2.png' },
                    { class: '3반', img: '/images/time2_3.png' },
                    { class: '4반', img: '/images/time2_4.png' },
                    { class: '5반', img: '/images/time2_5.png' },
                    { class: '6반', img: '/images/time2_6.png' },
                    { class: '7반', img: '/images/time2_7.png' },
                    { class: '8반', img: '/images/time2_8.png' },
                ],
                '3': [
                    { class: '1반', img: '/images/time3_1.png' },
                    { class: '2반', img: '/images/time3_2.png' },
                    { class: '3반', img: '/images/time3_3.png' },
                    { class: '4반', img: '/images/time3_4.png' },
                    { class: '5반', img: '/images/time3_5.png' },
                    { class: '6반', img: '/images/time3_6.png' },
                    { class: '7반', img: '/images/time3_7.png' },
                    { class: '8반', img: '/images/time3_8.png' },
                ]
            };

            // 요소 선택
            const pages = document.querySelectorAll('.page');
            const navButtons = document.querySelectorAll('.nav-btn');
            const backButtons = document.querySelectorAll('.back-btn');
            const lunchMenuContainer = document.getElementById('lunch-menu-container');
            const lunchMenuList = document.getElementById('lunch-menu-list');
            const loadingMessage = document.getElementById('loading-message');
            const currentDateSpan = document.getElementById('current-date');
            const prevDayBtn = document.getElementById('prev-day');
            const nextDayBtn = document.getElementById('next-day');
            
            const majorButtons = document.querySelectorAll('[data-major]');
            const majorContentContainer = document.getElementById('major-content-container');
            const majorTitle = document.getElementById('major-title');
            const majorDescription = document.getElementById('major-description');
            
            const homePageButtons = document.querySelectorAll('#page-home [data-page]');
            const timetableTitle = document.getElementById('timetable-title');
            const gradeSelection = document.getElementById('grade-selection');
            const classSelectionContainer = document.getElementById('class-selection-container');
            
            // Modal elements
            const imageModal = document.getElementById('image-modal');
            const modalImage = document.getElementById('modal-image');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const closeModalX = document.getElementById('close-modal-x');

            let today = new Date(); // 급식 날짜를 관리할 변수

            // 페이지 전환 함수
            const showPage = (pageId) => {
                pages.forEach(page => page.classList.add('hidden'));
                document.getElementById(`page-${pageId}`).classList.remove('hidden');
                
                // 시간표 페이지로 이동하면 초기 화면으로 리셋
                if (pageId === 'time') {
                    resetTimetablePage();
                }
                
                // 급식 페이지로 이동 시 급식 정보 다시 불러오기
                if (pageId === 'bob') {
                    fetchLunchMenu(today);
                }
            };

            // 시간표 페이지 초기 상태로 되돌리기
            const resetTimetablePage = () => {
                timetableTitle.textContent = "시간표";
                gradeSelection.classList.remove('hidden');
                classSelectionContainer.classList.add('hidden');
                classSelectionContainer.innerHTML = '';
            };


            // 오늘 날짜를 YYYYMMDD 형식으로 가져오는 함수
            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}${month}${day}`;
            };
            
            // 날짜 표시 업데이트 함수
            const updateDateDisplay = (date) => {
                const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' };
                currentDateSpan.textContent = date.toLocaleDateString('ko-KR', options);
            };

            // 급식 정보 가져오는 함수
            const fetchLunchMenu = async (date) => {
                const dateToFetch = formatDate(date);
                const url = `${baseUrl}?KEY=${serviceKey}&Type=json&ATPT_OFCDC_SC_CODE=${atptOfcdcScCode}&SD_SCHUL_CODE=${sdSchulCode}&MLSV_YMD=${dateToFetch}`;
                
                // 로딩 상태 표시
                loadingMessage.classList.remove('hidden');
                lunchMenuList.classList.add('hidden');
                lunchMenuList.innerHTML = '';
                
                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    let menuItems = [];
                    // API 응답 구조 확인
                    if (data && data.mealServiceDietInfo && data.mealServiceDietInfo.length > 1 && data.mealServiceDietInfo[1].row) {
                        const menuData = data.mealServiceDietInfo[1].row[0].DDISH_NM;
                        // 괄호 안의 알레르기 정보와 숫자, 점(.) 제거
                        menuItems = menuData.split('<br/>').map(item => {
                            let cleanedItem = item.replace(/\([^)]*\)/g, '').replace(/([0-9\.])+/g, '').trim();
                            return cleanedItem;
                        }).filter(item => item !== ''); // 빈 항목 제거
                    } else if (data && data.RESULT && data.RESULT.CODE === 'INFO-200') {
                        // 정보 없음
                        menuItems = ["급식 정보가 없습니다."];
                    } else {
                        throw new Error("API 응답 형식이 올바르지 않습니다.");
                    }

                    if (menuItems.length > 0) {
                        menuItems.forEach(item => {
                            const li = document.createElement('li');
                            li.textContent = item;
                            lunchMenuList.appendChild(li);
                        });
                        loadingMessage.classList.add('hidden');
                        lunchMenuList.classList.remove('hidden');
                    } else {
                        // 빈 배열인 경우
                        loadingMessage.textContent = "급식 정보가 없습니다.";
                    }

                } catch (error) {
                    console.error('급식 정보를 가져오는 중 오류 발생:', error);
                    loadingMessage.textContent = "급식 정보를 불러오는데 실패했습니다.";
                }
            };
            
            // 이벤트 리스너 설정
            homePageButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const page = btn.dataset.page;
                    showPage(page);
                });
            });

            // 뒤로가기 버튼 이벤트 리스너
            backButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    showPage('home');
                });
            });

            // 급식 날짜 변경 버튼
            prevDayBtn.addEventListener('click', () => {
                today.setDate(today.getDate() - 1);
                updateDateDisplay(today);
                fetchLunchMenu(today);
            });

            nextDayBtn.addEventListener('click', () => {
                today.setDate(today.getDate() + 1);
                updateDateDisplay(today);
                fetchLunchMenu(today);
            });

            // 전공 버튼 클릭 시 내용 표시
            majorButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const major = btn.dataset.major;
                    const content = majorData[major];
                    if (content) {
                        majorTitle.textContent = content.title;
                        majorDescription.textContent = content.description;
                        majorContentContainer.classList.remove('hidden');
                    }
                });
            });

            // 학년 선택 버튼 클릭 시 반 목록 표시
            document.querySelectorAll('.grade-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const grade = e.target.dataset.grade;
                    const classes = timetableData[grade];

                    timetableTitle.textContent = `${grade}학년 시간표`;
                    gradeSelection.classList.add('hidden');
                    classSelectionContainer.classList.remove('hidden');

                    classSelectionContainer.innerHTML = '';
                    classes.forEach(item => {
                        const card = document.createElement('div');
                        card.classList.add('timetable-card', 'bg-blue-50', 'rounded-xl', 'shadow-md', 'p-4', 'text-center', 'cursor-pointer', 'hover:bg-blue-100', 'transition-colors');
                        card.setAttribute('data-img', item.img);
                        
                        card.innerHTML = `<h3 class="text-lg font-semibold text-blue-700">${item.class}</h3>`;
                        classSelectionContainer.appendChild(card);
                    });
                });
            });
            
            // 동적으로 생성된 시간표 카드에 대한 이벤트 위임
            classSelectionContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.timetable-card');
                if (card) {
                    const imgSrc = card.getAttribute('data-img');
                    modalImage.src = imgSrc;
                    imageModal.classList.remove('hidden');
                }
            });


            // 모달 닫기 함수
            const closeModal = () => {
                imageModal.classList.add('hidden');
            };

            // 모달 닫기 버튼과 X 버튼에 이벤트 리스너 추가
            closeModalBtn.addEventListener('click', closeModal);
            closeModalX.addEventListener('click', closeModal);

            // 모달 외부 클릭 시 닫기
            imageModal.addEventListener('click', (e) => {
                if (e.target === imageModal) {
                    closeModal();
                }
            });

            // 초기 페이지 로드
            updateDateDisplay(today);
            showPage('home');
        });
    </script>
</body>
</html>
