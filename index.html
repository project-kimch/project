
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‰íƒë§ˆì´ìŠ¤í„°ê³ ë“±í•™êµ ì•±</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .control-btn:active { transform: scale(0.9); }

        .card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, background-color 0.3s ease-in-out;
        }

        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 25px rgba(0,0,0,0.2);
        }

        /* Timetable card specific styling */
        .timetable-card {
            background-color: #f5f3ff; /* Purple-50 */
        }

        .timetable-card:hover {
            background-color: #e5e7eb; /* Gray-200 */
        }

        /* Timetable image modal */
        #modal-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center">

    <!-- App Container -->
    <div id="app" class="bg-white shadow-2xl rounded-3xl w-[375px] h-[667px] max-w-full max-h-full flex flex-col overflow-hidden border-8 border-gray-800">
        
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 text-center shadow-lg">
            <h1 class="text-2xl font-bold">í‰íƒë§ˆì´ìŠ¤í„°ê³ ë“±í•™êµ</h1>
        </header>

        <!-- Main Content Area (dynamic) -->
        <main class="flex-1 overflow-y-auto p-4 bg-gray-50">

            <!-- Home Page -->
            <div id="page-home" class="page">
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                <div class="grid grid-cols-2 gap-6">
                    <div data-page="gaeyo" class="card bg-gradient-to-br from-indigo-500 to-purple-600 p-6 rounded-2xl shadow-lg text-center text-white cursor-pointer">
                        <!-- Info Icon SVG -->
                        <svg class="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>
                        <h3 class="font-semibold text-xl">í•™êµ ê°œìš”</h3>
                    </div>
                    <div data-page="time" class="card bg-gradient-to-br from-green-500 to-teal-600 p-6 rounded-2xl shadow-lg text-center text-white cursor-pointer">
                        <!-- Calendar Icon SVG -->
                        <svg class="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/></svg>
                        <h3 class="font-semibold text-xl">ì‹œê°„í‘œ</h3>
                    </div>
                    <div data-page="bob" class="card bg-gradient-to-br from-yellow-500 to-orange-600 p-6 rounded-2xl shadow-lg text-center text-white cursor-pointer">
                        <!-- Lunch Icon SVG -->
                        <svg class="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24"><path d="M21 5H3c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zM8 12c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13 5H3V7h18v10z"/></svg>
                        <h3 class="font-semibold text-xl">ê¸‰ì‹</h3>
                    </div>
                    <div data-page="cm" class="card bg-gradient-to-br from-rose-500 to-red-600 p-6 rounded-2xl shadow-lg text-center text-white cursor-pointer">
                        <!-- Shield Icon SVG -->
                        <svg class="w-12 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2L4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5l-8-3z"/></svg>
                        <h3 class="font-semibold text-xl">ì „ê³µ ì†Œê°œ</h3>
                    </div>
                      <div data-page="cart" class="card bg-gradient-to-br from-yellow-500 to-orange-600 p-6 rounded-2xl shadow-lg text-center text-white cursor-pointer w-[325px]">
                        <!-- Lunch Icon SVG -->
                        <svg class="w-26 h-12 mx-auto mb-2" fill="currentColor" viewBox="0 0 24 24"><path d="M21 5H3c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zM8 12c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13 5H3V7h18v10z"/></svg>
                        <h3 class="font-semibold text-xl">ì¹´íŠ¸ ì„¤ì •</h3> 
                    </div>
                </div>
            </div>

            <!-- School Overview Page -->
            <div id="page-gaeyo" class="page hidden">
                <button data-page="home" class="back-btn mb-4 px-4 py-2 bg-gray-200 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">â† ë’¤ë¡œê°€ê¸°</button>
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">í•™êµ ê°œìš”</h2>
                <div class="bg-gray-100 p-6 rounded-2xl shadow-lg">
                    <p class="text-gray-600 leading-relaxed mb-4">
                        í‰íƒë§ˆì´ìŠ¤í„°ê³ ë“±í•™êµëŠ” ë¯¸ë˜ ì‚°ì—…ì„ ì´ëŒì–´ê°ˆ ì°½ì˜ì ì¸ ê¸°ìˆ  ì¸ì¬ë¥¼ ì–‘ì„±í•˜ëŠ” ë° ì£¼ë ¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. ìµœì‹  ì‹œì„¤ê³¼ ìš°ìˆ˜í•œ êµìœ¡ ê³¼ì •ì„ í†µí•´ í•™ìƒë“¤ì´ ì „ë¬¸ì„±ê³¼ ì¸ì„±ì„ ëª¨ë‘ ê°–ì¶˜ ê¸€ë¡œë²Œ ì¸ì¬ë¡œ ì„±ì¥í•˜ë„ë¡ ë•ê³  ìˆìŠµë‹ˆë‹¤.
                    </p>
                    <p class="text-blue-600 font-semibold text-center mt-4">"ê¿ˆì„ í–¥í•´ ì„±ì¥í•˜ëŠ” ê¸€ë¡œë²Œ ì¸ì¬ ìœ¡ì„±!"</p>
                </div>
            </div>
            
            <!-- Timetable Page -->
            <div id="page-time" class="page hidden">
                <button data-page="home" class="back-btn mb-4 px-4 py-2 bg-gray-200 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">â† ë’¤ë¡œê°€ê¸°</button>
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center" id="timetable-title">ì‹œê°„í‘œ</h2>

                <!-- Grade Selection -->
                <div id="grade-selection" class="flex flex-col space-y-4 mb-4">
                    <button data-grade="1" class="grade-btn w-full bg-blue-500 text-white px-6 py-3 rounded-2xl font-bold hover:bg-blue-600 transition-colors shadow-lg">1í•™ë…„</button>
                    <button data-grade="2" class="grade-btn w-full bg-blue-500 text-white px-6 py-3 rounded-2xl font-bold hover:bg-blue-600 transition-colors shadow-lg">2í•™ë…„</button>
                    <button data-grade="3" class="grade-btn w-full bg-blue-500 text-white px-6 py-3 rounded-2xl font-bold hover:bg-blue-600 transition-colors shadow-lg">3í•™ë…„</button>
                </div>

                <!-- Class Selection Grid (Initially hidden) -->
                <div id="class-selection-container" class="grid grid-cols-2 gap-4 max-w-lg mx-auto hidden">
                </div>
            </div>

            <!-- Lunch Menu Page -->
            <div id="page-bob" class="page hidden">
                <button data-page="home" class="back-btn mb-4 px-4 py-2 bg-gray-200 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">â† ë’¤ë¡œê°€ê¸°</button>
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">ì˜¤ëŠ˜ì˜ ê¸‰ì‹</h2>
                <div class="flex items-center justify-between mb-4">
                    <button id="prev-day" class="bg-gray-200 p-2 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">&#9664;</button>
                    <span id="current-date" class="font-bold text-lg text-gray-800"></span>
                    <button id="next-day" class="bg-gray-200 p-2 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">&#9654;</button>
                </div>
                <div id="lunch-menu-container" class="bg-white p-6 rounded-2xl shadow-lg min-h-[150px] flex flex-col justify-center items-center">
                    <p id="loading-message" class="text-center text-gray-500">ê¸‰ì‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    <ul id="lunch-menu-list" class="space-y-2 text-gray-700 hidden w-full"></ul>
                </div>
            </div>

            <!-- Major Introduction Page -->
            <div id="page-cm" class="page hidden">
                <button data-page="home" class="back-btn mb-4 px-4 py-2 bg-gray-200 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">â† ë’¤ë¡œê°€ê¸°</button>
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">ì „ê³µ ì†Œê°œ</h2>
                <div class="grid grid-cols-2 gap-4">
                    <button data-major="brother" class="card bg-yellow-100 p-4 rounded-2xl shadow-lg text-center text-yellow-800 hover:bg-yellow-200 transition-colors">ì‚°ì—…ì„¤ë¹„ê³¼</button>
                    <button data-major="machine" class="card bg-green-100 p-4 rounded-2xl shadow-lg text-center text-green-800 hover:bg-green-200 transition-colors">ë¡œë´‡ì œì–´ì‹œìŠ¤í…œê³¼</button>
                    <button data-major="auto" class="card bg-red-100 p-4 rounded-2xl shadow-lg text-center text-red-800 hover:bg-red-200 transition-colors">ìë™ì°¨ITê³¼</button>
                    <button data-major="elec" class="card bg-purple-100 p-4 rounded-2xl shadow-lg text-center text-purple-800 hover:bg-purple-200 transition-colors">ìŠ¤ë§ˆíŠ¸ì „ìì œì–´ê³¼</button>
                </div>
                <div id="major-content-container" class="mt-6 p-6 bg-white rounded-2xl shadow-lg hidden">
                    <h3 id="major-title" class="text-xl font-bold text-gray-800 mb-2"></h3>
                    <p id="major-description" class="text-gray-600 leading-relaxed"></p>
                </div>
            </div>

            <!-- Cart Page -->
            <div id="page-cart" class="page hidden">
            <button data-page="home" class="back-btn mb-4 px-4 py-2 bg-gray-200 rounded-full text-gray-600 hover:bg-gray-300 transition">
                â† ë’¤ë¡œê°€ê¸°
            </button>

            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">ì¹´íŠ¸ ì„¤ì •</h2>

            <div class="bg-white p-6 rounded-2xl shadow-lg max-w-xs mx-auto flex flex-col items-center space-y-4">
                <div class="flex items-center justify-between w-full">
                <span class="text-gray-700 font-medium">ìë™ ëª¨ë“œ</span>

                <!-- âœ… í† ê¸€ ìŠ¤ìœ„ì¹˜ -->
                <label class="relative inline-flex items-center cursor-pointer select-none">
                    <input type="checkbox" id="modeToggle" class="sr-only peer">
                    <!-- ë§‰ëŒ€ -->
                    <div class="w-14 h-8 bg-gray-300 rounded-full peer-checked:bg-blue-500 transition-colors duration-300"></div>
                    <!-- ë™ê·¸ë¼ë¯¸ -->
                    <div class="absolute left-1 top-1 w-6 h-6 bg-white rounded-full shadow-md transform transition-transform duration-300 peer-checked:translate-x-6"></div>
                </label>
                </div>

                <p id="modeText" class="text-gray-600 text-sm text-center">
                í˜„ì¬: <span class="font-semibold">ìˆ˜ë™ ëª¨ë“œ</span>
                </p>

                <!-- ğŸ® ìˆ˜ë™ ì¡°ì¢… ë²„íŠ¼ (ì‹­ìí˜•) -->
                <div id="manualControls" class="hidden flex flex-col items-center justify-center mt-8">
                <!-- ìœ„ ë²„íŠ¼ -->
                <button 
                    class="control-btn bg-blue-500 hover:bg-blue-600 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-md text-2xl transition">
                    â–²
                </button>

                <!-- ê°€ìš´ë° ì˜ì—­ (ì¢Œ, ì¤‘ì•™, ìš°) -->
                <div class="flex items-center justify-center space-x-6 my-3">
                    <!-- ì™¼ìª½ -->
                    <button 
                    class="control-btn bg-blue-500 hover:bg-blue-600 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-md text-2xl transition">
                    â—€
                    </button>

                    <!-- ì¤‘ì•™ (ë¹ˆì¹¸ ë˜ëŠ” ì¥ì‹ìš© ì›í˜• ì¤‘ì•™ ë²„íŠ¼) -->
                    <div class="bg-gray-300 rounded-full w-12 h-12 shadow-inner"></div>

                    <!-- ì˜¤ë¥¸ìª½ -->
                    <button 
                    class="control-btn bg-blue-500 hover:bg-blue-600 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-md text-2xl transition">
                    â–¶
                    </button>
                </div>

                <!-- ì•„ë˜ ë²„íŠ¼ -->
                <button 
                    class="control-btn bg-blue-500 hover:bg-blue-600 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-md text-2xl transition">
                    â–¼
                </button>
                </div>
            </div>
            </div>
            </div>

        </main>
        
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const toggle = document.getElementById('modeToggle');
            const modeText = document.getElementById('modeText');
            const manualControls = document.getElementById('manualControls');

            toggle.addEventListener('change', () => {
                if (toggle.checked) {
                modeText.innerHTML = 'í˜„ì¬: <span class="font-semibold text-blue-600">ìë™ ëª¨ë“œ</span>';
                manualControls.classList.add('hidden');
                } else {
                modeText.innerHTML = 'í˜„ì¬: <span class="font-semibold text-gray-800">ìˆ˜ë™ ëª¨ë“œ</span>';
                manualControls.classList.remove('hidden');
                }
            });
            // API ì •ë³´
            const serviceKey = '3c12807e4d8d42a0ad5b9f266bc209fa';
            const baseUrl = 'https://open.neis.go.kr/hub/mealServiceDietInfo';
            const atptOfcdcScCode = 'J10'; // ê²½ê¸°ë„êµìœ¡ì²­ ì½”ë“œ
            const sdSchulCode = '7531408'; // í‰íƒë§ˆì´ìŠ¤í„°ê³ ë“±í•™êµ ì½”ë“œ
            
            // ì „ê³µ ì†Œê°œ ë°ì´í„°
            const majorData = {
                brother: {
                    title: "ì‚°ì—…ì„¤ë¹„ê³¼",
                    description: "ì‚°ì—…ì„¤ë¹„ê³¼ëŠ” ê¸°ê³„ ë° ì„¤ë¹„ ë¶„ì•¼ì˜ ê¸°ìˆ  ì „ë¬¸ê°€ë¥¼ ì–‘ì„±í•©ë‹ˆë‹¤. ë‹¤ì–‘í•œ ê³µì¥ ìë™í™” ì‹œìŠ¤í…œ, ë°°ê´€ ë° ìš©ì ‘ ê¸°ìˆ  ë“±ì„ ë°°ì›ë‹ˆë‹¤."
                },
                machine: {
                    title: "ë¡œë´‡ì œì–´ì‹œìŠ¤í…œê³¼",
                    description: "ë¡œë´‡ì œì–´ì‹œìŠ¤í…œê³¼ëŠ” ì‚°ì—…ìš© ë¡œë´‡ì˜ ì„¤ê³„, ì œì‘, ì œì–´ ë° ìš´ì˜ ê¸°ìˆ ì„ ìŠµë“í•©ë‹ˆë‹¤. 4ì°¨ ì‚°ì—…í˜ëª… ì‹œëŒ€ì˜ í•µì‹¬ ê¸°ìˆ ì„ ë‹¤ë£¹ë‹ˆë‹¤."
                },
                auto: {
                    title: "ìë™ì°¨ITê³¼",
                    description: "ìë™ì°¨ITê³¼ëŠ” ë¯¸ë˜ ìë™ì°¨ ì‚°ì—…ì„ ì„ ë„í•  ê¸°ìˆ  ì¸ì¬ë¥¼ ì–‘ì„±í•©ë‹ˆë‹¤. ì¹œí™˜ê²½ ìë™ì°¨, ììœ¨ì£¼í–‰ ê¸°ìˆ  ë“± IT ìœµí•© ê¸°ìˆ ì„ ë°°ì›ë‹ˆë‹¤."
                },
                elec: {
                    title: "ìŠ¤ë§ˆíŠ¸ì „ìì œì–´ê³¼",
                    description: "ìŠ¤ë§ˆíŠ¸ì „ìì œì–´ê³¼ëŠ” ì „ìê¸°ê¸° ë° ì‹œìŠ¤í…œì„ ì„¤ê³„í•˜ê³  ì œì–´í•˜ëŠ” ê¸°ìˆ ì„ ìµí™ë‹ˆë‹¤. íšŒë¡œ ì„¤ê³„, í”„ë¡œê·¸ë˜ë°, IoT ê¸°ìˆ  ë“±ì„ í¬í•¨í•©ë‹ˆë‹¤."
                }
            };

            // í•™ë…„ë³„ ì‹œê°„í‘œ ë°ì´í„° (ì´ë¯¸ì§€ ë§í¬ë¥¼ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.)
            const timetableData = {
                '1': [
                    { class: '1ë°˜', img: '/images/time1_1.png' },
                    { class: '2ë°˜', img: '/images/time1_2.png' },
                    { class: '3ë°˜', img: '/images/time1_3.png' },
                    { class: '4ë°˜', img: '/images/time1_4.png' },
                    { class: '5ë°˜', img: '/images/time1_5.png' },
                    { class: '6ë°˜', img: '/images/time1_6.png' },
                    { class: '7ë°˜', img: '/images/time1_7.png' },
                    { class: '8ë°˜', img: '/images/time1_8.png' },
                ],
                '2': [
                    { class: '1ë°˜', img: '/images/time2_1.png' },
                    { class: '2ë°˜', img: '/images/time2_2.png' },
                    { class: '3ë°˜', img: '/images/time2_3.png' },
                    { class: '4ë°˜', img: '/images/time2_4.png' },
                    { class: '5ë°˜', img: '/images/time2_5.png' },
                    { class: '6ë°˜', img: '/images/time2_6.png' },
                    { class: '7ë°˜', img: '/images/time2_7.png' },
                    { class: '8ë°˜', img: '/images/time2_8.png' },
                ],
                '3': [
                    { class: '1ë°˜', img: '/images/time3_1.png' },
                    { class: '2ë°˜', img: '/images/time3_2.png' },
                    { class: '3ë°˜', img: '/images/time3_3.png' },
                    { class: '4ë°˜', img: '/images/time3_4.png' },
                    { class: '5ë°˜', img: '/images/time3_5.png' },
                    { class: '6ë°˜', img: '/images/time3_6.png' },
                    { class: '7ë°˜', img: '/images/time3_7.png' },
                    { class: '8ë°˜', img: '/images/time3_8.png' },
                ]
            };

            // ìš”ì†Œ ì„ íƒ
            const pages = document.querySelectorAll('.page');
            const navButtons = document.querySelectorAll('.nav-btn');
            const backButtons = document.querySelectorAll('.back-btn');
            const lunchMenuContainer = document.getElementById('lunch-menu-container');
            const lunchMenuList = document.getElementById('lunch-menu-list');
            const loadingMessage = document.getElementById('loading-message');
            const currentDateSpan = document.getElementById('current-date');
            const prevDayBtn = document.getElementById('prev-day');
            const nextDayBtn = document.getElementById('next-day');
            
            const majorButtons = document.querySelectorAll('[data-major]');
            const majorContentContainer = document.getElementById('major-content-container');
            const majorTitle = document.getElementById('major-title');
            const majorDescription = document.getElementById('major-description');
            
            const homePageButtons = document.querySelectorAll('#page-home [data-page]');
            const timetableTitle = document.getElementById('timetable-title');
            const gradeSelection = document.getElementById('grade-selection');
            const classSelectionContainer = document.getElementById('class-selection-container');
            
            // Modal elements
            const imageModal = document.getElementById('image-modal');
            const modalImage = document.getElementById('modal-image');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const closeModalX = document.getElementById('close-modal-x');

            let today = new Date(); // ê¸‰ì‹ ë‚ ì§œë¥¼ ê´€ë¦¬í•  ë³€ìˆ˜

            // í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜
            const showPage = (pageId) => {
                pages.forEach(page => page.classList.add('hidden'));
                document.getElementById(`page-${pageId}`).classList.remove('hidden');
                
                // ì‹œê°„í‘œ í˜ì´ì§€ë¡œ ì´ë™í•˜ë©´ ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ë¦¬ì…‹
                if (pageId === 'time') {
                    resetTimetablePage();
                }
                
                // ê¸‰ì‹ í˜ì´ì§€ë¡œ ì´ë™ ì‹œ ê¸‰ì‹ ì •ë³´ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
                if (pageId === 'bob') {
                    fetchLunchMenu(today);
                }
            };

            // ì‹œê°„í‘œ í˜ì´ì§€ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦¬ê¸°
            const resetTimetablePage = () => {
                timetableTitle.textContent = "ì‹œê°„í‘œ";
                gradeSelection.classList.remove('hidden');
                classSelectionContainer.classList.add('hidden');
                classSelectionContainer.innerHTML = '';
            };


            // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ YYYYMMDD í˜•ì‹ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
            const formatDate = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}${month}${day}`;
            };
            
            // ë‚ ì§œ í‘œì‹œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            const updateDateDisplay = (date) => {
                const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' };
                currentDateSpan.textContent = date.toLocaleDateString('ko-KR', options);
            };

            // ê¸‰ì‹ ì •ë³´ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
            const fetchLunchMenu = async (date) => {
                const dateToFetch = formatDate(date);
                const url = `${baseUrl}?KEY=${serviceKey}&Type=json&ATPT_OFCDC_SC_CODE=${atptOfcdcScCode}&SD_SCHUL_CODE=${sdSchulCode}&MLSV_YMD=${dateToFetch}`;
                
                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                loadingMessage.classList.remove('hidden');
                lunchMenuList.classList.add('hidden');
                lunchMenuList.innerHTML = '';
                
                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    let menuItems = [];
                    // API ì‘ë‹µ êµ¬ì¡° í™•ì¸
                    if (data && data.mealServiceDietInfo && data.mealServiceDietInfo.length > 1 && data.mealServiceDietInfo[1].row) {
                        const menuData = data.mealServiceDietInfo[1].row[0].DDISH_NM;
                        // ê´„í˜¸ ì•ˆì˜ ì•Œë ˆë¥´ê¸° ì •ë³´ì™€ ìˆ«ì, ì (.) ì œê±°
                        menuItems = menuData.split('<br/>').map(item => {
                            let cleanedItem = item.replace(/\([^)]*\)/g, '').replace(/([0-9\.])+/g, '').trim();
                            return cleanedItem;
                        }).filter(item => item !== ''); // ë¹ˆ í•­ëª© ì œê±°
                    } else if (data && data.RESULT && data.RESULT.CODE === 'INFO-200') {
                        // ì •ë³´ ì—†ìŒ
                        menuItems = ["ê¸‰ì‹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤."];
                    } else {
                        throw new Error("API ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    }

                    if (menuItems.length > 0) {
                        menuItems.forEach(item => {
                            const li = document.createElement('li');
                            li.textContent = item;
                            lunchMenuList.appendChild(li);
                        });
                        loadingMessage.classList.add('hidden');
                        lunchMenuList.classList.remove('hidden');
                    } else {
                        // ë¹ˆ ë°°ì—´ì¸ ê²½ìš°
                        loadingMessage.textContent = "ê¸‰ì‹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";
                    }

                } catch (error) {
                    console.error('ê¸‰ì‹ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                    loadingMessage.textContent = "ê¸‰ì‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                }
            };
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            homePageButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const page = btn.dataset.page;
                    showPage(page);
                });
            });

            // ë’¤ë¡œê°€ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            backButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    showPage('home');
                });
            });

            // ê¸‰ì‹ ë‚ ì§œ ë³€ê²½ ë²„íŠ¼
            prevDayBtn.addEventListener('click', () => {
                today.setDate(today.getDate() - 1);
                updateDateDisplay(today);
                fetchLunchMenu(today);
            });

            nextDayBtn.addEventListener('click', () => {
                today.setDate(today.getDate() + 1);
                updateDateDisplay(today);
                fetchLunchMenu(today);
            });

            // ì „ê³µ ë²„íŠ¼ í´ë¦­ ì‹œ ë‚´ìš© í‘œì‹œ
            majorButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const major = btn.dataset.major;
                    const content = majorData[major];
                    if (content) {
                        majorTitle.textContent = content.title;
                        majorDescription.textContent = content.description;
                        majorContentContainer.classList.remove('hidden');
                    }
                });
            });

            // í•™ë…„ ì„ íƒ ë²„íŠ¼ í´ë¦­ ì‹œ ë°˜ ëª©ë¡ í‘œì‹œ
            document.querySelectorAll('.grade-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const grade = e.target.dataset.grade;
                    const classes = timetableData[grade];

                    timetableTitle.textContent = `${grade}í•™ë…„ ì‹œê°„í‘œ`;
                    gradeSelection.classList.add('hidden');
                    classSelectionContainer.classList.remove('hidden');

                    classSelectionContainer.innerHTML = '';
                    classes.forEach(item => {
                        const card = document.createElement('div');
                        card.classList.add('timetable-card', 'bg-blue-50', 'rounded-xl', 'shadow-md', 'p-4', 'text-center', 'cursor-pointer', 'hover:bg-blue-100', 'transition-colors');
                        card.setAttribute('data-img', item.img);
                        
                        card.innerHTML = `<h3 class="text-lg font-semibold text-blue-700">${item.class}</h3>`;
                        classSelectionContainer.appendChild(card);
                    });
                });
            });
            
            // ë™ì ìœ¼ë¡œ ìƒì„±ëœ ì‹œê°„í‘œ ì¹´ë“œì— ëŒ€í•œ ì´ë²¤íŠ¸ ìœ„ì„
            classSelectionContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.timetable-card');
                if (card) {
                    const imgSrc = card.getAttribute('data-img');
                    modalImage.src = imgSrc;
                    imageModal.classList.remove('hidden');
                }
            });


            // ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
            const closeModal = () => {
                imageModal.classList.add('hidden');
            };

            // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ê³¼ X ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            closeModalBtn.addEventListener('click', closeModal);
            closeModalX.addEventListener('click', closeModal);

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            imageModal.addEventListener('click', (e) => {
                if (e.target === imageModal) {
                    closeModal();
                }
            });

            // ì´ˆê¸° í˜ì´ì§€ ë¡œë“œ
            updateDateDisplay(today);
            showPage('home');
        });
    </script>
</body>
</html>
